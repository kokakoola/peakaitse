<section class="jumbotron imaged animated bounceInRight">
    <div class="container " id="js-toGo">
        <div class="row">
            <div class="col-xs-12 col-sm-10">
                <p>Sinu kodu peakaitse on nagu uks elektrivõrku. Peakaitse suurus määrab, kui võimsaid koduseadmeid saad üheaegselt kasutada. Külmik ja arvuti korraga vajavad väiksemat “ust” kui soojaveeboiler ja põrandaküte jne.
                </p>
                <p>
                On oluline, et elektritarbimise suurus ja peakaitse suurus oleksid omavahel tasakaalus. Majapidamiste peakaitsete suuruste järgi planeerib võrguettevõte alajaamade ja liinide tugevused. Kui vajalikust suuremaid peakaitsmid on palju, ehitatakse vajalikust tugevam, seega ka kallim võrk. Koduomanikule võib see tähendada võrguteenuse arvel suuremat ampritasu. Vali õige suurusega peakaitse – võidad sina, võidavad su naabrid, võidab keskkond!</p>
            </div>
        </div>
        <div class="row comeTogether">
            <div class="col-sm-9 col-sm-offset-1 text-right animated bounceInLeft">
                <blockquote class="blockquote-reverse">Kas Sinu kodu/ettevõtte elektrisüsteemi peakaitse on tarbimisega tasakaalus?</blockquote>
            </div>
            <div class="col-sm-1 animated bounceInRight">
                <br>
                <br>
                <a class="btn btn-outline-inverse btn-lg" id="js-Next">Vaata järgi <i class="glyphicon glyphicon-circle-arrow-right"></i></a>
            </div>
        </div>
    </div>
    <div class="container hide login" id="js-toCome">
        <div class="row">
            <div class="col-sm-10 col-sm-offset-1">
                <p>ID-kaardiga sisselogimine on vajalik, et võiksime kindlad olla Sinu ligipääsus ainult neile tarbimisandmetele, mida Sul on õigus näha.
                </p>
            </div>
            <div class="col-xs-12 col-sm-8 text-right mobile-id">
                <form action="midAuth" method="post" name="phonenoform" class="form-inline">
                    <div class="form-group">
                        <label for="phoneNumber" class="text-inverse">Telefoninumber</label>
                        <input type="text" class="form-control input-lg" id="phoneNumber"  placeholder="5055555">
                        <button onclick="javascript: midAuth()" class="btn btn-outline-inverse btn-lg" id="js-codeSent">Logi sisse Mobiil ID-ga <i class="glyphicon glyphicon-circle-arrow-right"></i></button>
                    </div>
                </form>
            </div>
            <div class="col-xs-12 col-sm-4 id-card">
                <button onclick="window.location.href='view.html'" class="btn btn-outline-inverse btn-lg" id="js-goOnMobileID">Logi sisse ID-kaardiga <i class="glyphicon glyphicon-circle-arrow-right"></i></button>
                <p class="text-inverse success hide" id="js-comeOnMobileID">
                    Sinu telefonile on saadetud kinnituskood <div id="challengeId">0000</div>
                    <a href="" class="btn btn-link right">Katkesta</a>
                </p>
                <p class="text-inverse error hide" id="errorMessage">
                    Sul pole kehtivat mobiil-ID lepingut. 
                    <a href="" class="btn btn-link right">Katkesta</a>
                </p>
            </div>

        </div>
    </div>
    <script>
    function midAuth() {
      xhr=new XMLHttpRequest();
      xhr.open("POST","midAuth",true);
      xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      xhr.onreadystatechange=function() {
        if (xhr.readyState==4 && xhr.status==200) {
          data = JSON.parse(xhr.responseText);
          document.getElementById('challengeId').innerHTML = data.challengeId;
          midPoll();
        }
      }
      s = "phoneNo="+document.getElementById('phoneNumber').value;
      xhr.send(s);
    }

    function midPoll() {
      xhr=new XMLHttpRequest();
      xhr.open("POST","midStatus",true);
      xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      xhr.onreadystatechange=function() {
        if (xhr.readyState==4 && xhr.status==200) {
          data = JSON.parse(xhr.responseText);
          switch(data.status) {
            case 'OUTSTANDING_TRANSACTION':
              setTimeout(function() {midPoll();}, 2000);
              break;
            case 'USER_AUTHENTICATED':
              document.location.href=data.dashboardUrl;
              break;
            default:
					// data.status võimalikud väärtused:
					// NOT_VALID – toiming on lõppenud, kuid kasutaja poolt tekitatud signatuur ei ole kehtiv
					// EXPIRED_TRANSACTION – tegevus on aegunud
					// USER_CANCEL – kasutaja katkestas
					// MID_NOT_READY - Mobiil-ID funktsionaalsus ei ole veel kasutatav, proovida mõne aja pärast uuesti
					// PHONE_ABSENT – telefon ei ole levis
					// SENDING_ERROR – Muu sõnumi saatmise viga (telefon ei suuda sõnumit vastu võtta, sõnumikeskus häiritud)
					// SIM_ERROR – SIM rakenduse viga
					// INTERNAL_ERROR – teenuse tehniline viga
					// AUTH_NOT_STARTED - autentimist pole alustatud: saab juhtuda siis, kui keegi otse URL-ga sellele PIN-lehele
					// SEE_SERVER_LOG - vea põhjust vaata serveri logifailist
              el = document.getElementById('errorMessage');
              el.innerHTML=data.status;
              if (el.className.endsWith('hide')) {
                cl = el.className.substring(0, el.className.length - 4);
                el.className = cl;
              }
              break;
          }
        }
      }
      s = "phoneNo="+document.getElementById('phoneNumber').value;
      xhr.send(s);
    }
    </script>
</section>